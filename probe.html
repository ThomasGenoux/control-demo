<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Probe • Firebase /control live</title>
<style>
  body{background:#0b0f16;color:#e9eef6;font-family:system-ui,Segoe UI,Roboto,Arial;margin:0;padding:24px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
  .btn{padding:8px 12px;border:1px solid #1c2434;background:#12182a;color:#e9eef6;border-radius:10px;cursor:pointer}
  pre{background:#0b1220;border:1px solid #1c2434;border-radius:10px;padding:12px;white-space:pre-wrap;word-break:break-word;min-height:200px}
  .muted{color:#96a0b5} .err{color:#ff7b7b}
</style>
</head>
<body>
  <div class="row">
    <strong>Probe:</strong>
    <span class="muted">Affiche en temps réel le nœud <code>/control</code></span>
    <button id="refresh" class="btn">Forcer un fetch HTTP</button>
  </div>
  <div id="status" class="muted">Init...</div>
  <pre id="out">⏳</pre>

<script type="module">
const firebaseConfig = {
  apiKey: "AIzaSyBNix7CGySLt3ztIp3h4GyUfi1YGTuIbvA",
  authDomain: "control-panel-demo-59d4a.firebaseapp.com",
  databaseURL: "https://control-panel-demo-59d4a-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "control-panel-demo-59d4a",
  storageBucket: "control-panel-demo-59d4a.firebasestorage.app",
  messagingSenderId: "1083381420391",
  appId: "1:1083381420391:web:0d042a134004655a40dfc2",
  measurementId: "G-CKXT2SWQVW"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const statusEl = document.getElementById('status');
const out = document.getElementById('out');

function show(v){ out.textContent = JSON.stringify(v, null, 2); }
onValue(ref(db,'control'), (snap)=>{ show(snap.val()); statusEl.textContent='✅ onValue OK (temps réel)'; statusEl.className='muted'; },
  (e)=>{ statusEl.textContent='❌ onValue error: '+(e.code||e.message); statusEl.className='err'; });

document.getElementById('refresh').addEventListener('click', async ()=>{ 
  try { 
    const rs = await fetch(firebaseConfig.databaseURL + '/control.json');
    const js = await rs.json(); 
    show(js); 
    statusEl.textContent='HTTP fetch OK'; statusEl.className='muted';
  } catch(e){ statusEl.textContent='HTTP error: '+e; statusEl.className='err'; }
});
</script>
</body>
</html>
